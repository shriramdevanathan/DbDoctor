<?php/* Second Page PHP ScriptsCreated By Nikil Vasudevan*/include("connect.php");if(isset($_POST['action']) && !empty($_POST['action'])) {    $action = $_POST['action'];    switch($action) {        case 'lquery' : lquery();break;		case 'gmonitor' : gmonitor();break;		case 'dmonitor' : dmonitor();break;		case 'leddata' : leddata();break;		case 'paramDetails' : paramdetails();break;		case 'getbaseparam' : getbaseparam();break;		case 'setbaseparam' : setbaseparam();break;		case 'resetbaseparam' : resetbaseparam();break;    }}function lquery() {	$id = $_POST['id'];	$nvalue = $_POST['nvalue'];	$level = $_POST['level'];	//$id = 200;	//$nvalue = 500;	//$level = 1;	$conn = connect();	$stid = oci_parse($conn, 'begin cs5226.PKG_DB_MON.PROC_GET_STAT_LEVEL(:id,:nvalue,:level,:lvalue); end;');	$rc = oci_new_cursor($conn);	oci_bind_by_name($stid, ":id", $id);	oci_bind_by_name($stid, ":nvalue", $nvalue);	oci_bind_by_name($stid, ":level", $level);	oci_bind_by_name($stid, ':lvalue', $rc, -1, OCI_B_CURSOR);	oci_execute($stid);	oci_execute($rc);	$i=-1;	$k;	while ($row = oci_fetch_row($rc)) {				if($i != $row[0]){			if($i != -1){				$data[$i] = $k;			}			$i = $row[0];			$s = oci_parse($conn, "begin cs5226.PKG_DB_MON.PROC_GET_PARAM_NAME(:paramid, :retnm); end;");			oci_bind_by_name($s, ':paramid', $row[0]);			oci_bind_by_name($s, ':retnm', $pname,30);			oci_execute($s);			$k=$pname;		}		$k= $k.":".$row[1];	}	$data[$i] = $k;	oci_free_statement($stid);	oci_free_statement($s);	oci_free_statement($rc);	oci_close($conn);	echo json_encode($data);	}function gmonitor(){	$id = $_POST["id"];	$conn = connect();	$stmt = oci_parse($conn, 'begin cs5226.PKG_DB_MON.PROC_GET_STAT(:id,:value); end;');	oci_bind_by_name($stmt, ":id", $id);	oci_bind_by_name($stmt, ':value', $value,30);	oci_execute($stmt);	$stmt = oci_parse($conn, "begin cs5226.PKG_DB_MON.PROC_GET_PARAM_NAME(:paramid, :retnm); end;");	oci_bind_by_name($stmt, ':paramid', $id);	oci_bind_by_name($stmt, ':retnm', $pname,30);	oci_execute($stmt);	oci_free_statement($stmt);	oci_close($conn);	$dat[0] = $pname;	$dat[1] = $value;	echo json_encode($dat);}	function dmonitor(){	$id = $_POST["id"];	$level = $_POST["level"];	$nvalue = $_POST["nvalue"];	$conn = connect();	$stid = oci_parse($conn, 'begin cs5226.PKG_DB_MON.PROC_GET_STAT_OVERALL(:id,:nvalue,:level,:value); end;');	$rc = oci_new_cursor($conn);	oci_bind_by_name($stid, ":id", $id);	oci_bind_by_name($stid, ":nvalue", $nvalue);	oci_bind_by_name($stid, ":level", $level);	oci_bind_by_name($stid, ':value', $rc, -1, OCI_B_CURSOR);	oci_execute($stid);	oci_execute($rc);	$mdata = "";	while ($row = oci_fetch_row($rc)) {		$mdata = $mdata.":".$row[0];	}	oci_free_statement($stid);	oci_free_statement($rc);	oci_close($conn);	echo json_encode($mdata);	}function leddata() {	$id = $_POST["id"];	$conn = connect();	$stid = oci_parse($conn, 'begin cs5226.PKG_DB_MON.PROC_GET_STAT_LEVEL_LED(:id,:value); end;');	$rc = oci_new_cursor($conn);	oci_bind_by_name($stid, ":id", $id);	oci_bind_by_name($stid, ':value', $rc, -1, OCI_B_CURSOR);	oci_execute($stid);	oci_execute($rc);	$mdata = "";	while ($row = oci_fetch_row($rc)) {		$stmt = oci_parse($conn, "begin cs5226.PKG_DB_MON.PROC_GET_PARAM_NAME(:paramid, :retnm); end;");		oci_bind_by_name($stmt, ':paramid', $row[0]);		oci_bind_by_name($stmt, ':retnm', $pname,30);		oci_execute($stmt);		$mdata[$pname] = $row[1];	}	oci_free_statement($stid);	oci_free_statement($rc);	oci_close($conn);	echo json_encode($mdata);}function paramdetails() {	$conn = connect();	$id = $_POST['id'];	$level = $_POST['lgr'];	$s = oci_parse($conn, "begin cs5226.PKG_DB_MON.PROC_GET_PARAM_DETAIL(:param,:level,:ret); end;");	$rc = oci_new_cursor($conn);	oci_bind_by_name($s, ':ret', $rc, -1, OCI_B_CURSOR);	oci_bind_by_name($s, ':param', $id);	oci_bind_by_name($s, ':level', $level);	oci_execute($s);	oci_execute($rc);		if( $level == 1){		while ($row = oci_fetch_row($rc)) {					$data[$row[0]][0]=$row[1];			$data[$row[0]][1]=$row[2];		}	}else {			$data = array('CHILD' =>'','INIT_ORA' => '','PARENT'=>'');		while ($row = oci_fetch_row($rc)) {						if(!is_array($data[$row[0]])){ 				$data[$row[0]] = array(); 						} 			$content = $row[1].":".$row[2] ;			array_push($data[$row[0]],$content);		}	}		oci_free_statement($s);	oci_free_statement($rc);	oci_close($conn);	echo json_encode($data);}function getbaseparam() {	$id = $_POST['id'];	$conn = connect();	$s = oci_parse($conn, "begin cs5226.PKG_DB_MON.PROC_GET_CHILD(:id,:ret); end;");	$rc = oci_new_cursor($conn);	oci_bind_by_name($s, ':ret', $rc, -1, OCI_B_CURSOR);	oci_bind_by_name($s, ':id', $id);	oci_execute($s);	oci_execute($rc);		while ($row = oci_fetch_row($rc)) {					$data[] = $row;	}		oci_free_statement($s);	oci_free_statement($rc);	oci_close($conn);	echo json_encode($data);}function setbaseparam() {	$id = $_POST['id'];	$lgr = $_POST['lgr'];	$conn = connect();	$s;	if($lgr == 0){		$s = oci_parse($conn, "begin cs5226.PKG_DB_MON.PROC_SET_BASELINE(:id,:ret); end;");	}else if($lgr == 1){		$s = oci_parse($conn, "begin cs5226.PKG_DB_MON.PROC_SET_BASELINE_ALL(:id,:ret); end;");	}	oci_bind_by_name($s, ':ret', $rc, 30);	oci_bind_by_name($s, ':id', $id);	oci_execute($s);	oci_free_statement($s);	oci_close($conn);	echo json_encode($rc);}function resetbaseparam() {	$id = $_POST['id'];	$lgr = $_POST['lgr'];	$conn = connect();	$s;	if($lgr == 0){		$s = oci_parse($conn, "begin cs5226.PKG_DB_MON.PROC_RESET_BASELINE(:id,:ret); end;");	}else if($lgr == 1){		$s = oci_parse($conn, "begin cs5226.PKG_DB_MON.PROC_RESET_BASELINE_ALL(:id,:ret); end;");	}	oci_bind_by_name($s, ':ret', $rc, 30);	oci_bind_by_name($s, ':id', $id);	oci_execute($s);	oci_free_statement($s);	oci_close($conn);	echo json_encode($rc);}?>